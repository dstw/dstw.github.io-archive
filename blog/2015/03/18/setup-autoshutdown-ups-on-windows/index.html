<!DOCTYPE html>
<html>
  <head>
    
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="shortcut icon" href="/static/img/favicon.ico" />
        <title>Setup Autoshutdown UPS on Windows - Didik Setiawan</title>
        <meta name="author" content="Didik Setiawan" />
        <meta name="description" content="Setup Autoshutdown UPS on Windows" />
        <meta name="keywords" content="Setup Autoshutdown UPS on Windows, Didik Setiawan, batch, cmd, ups, win_server_2008, win_server_2008_r2" />

        <meta content="0" property="fb:app_id">
        <meta content="Didik Setiawan" property="og:site_name">
        
          <meta content="Setup Autoshutdown UPS on Windows" property="og:title">
        
        
          <meta content="article" property="og:type">
        
        
          <meta content="Didik Setiawan's Blog" property="og:description">
        
        
          <meta content="https://www.didiksetiawan.com/blog/2015/03/18/setup-autoshutdown-ups-on-windows/" property="og:url">
        
        
          <meta content="2015-03-18T21:04:31+07:00" property="article:published_time">
          <meta content="https://www.didiksetiawan.com/about/" property="article:author">
        
        
          <meta content="https://www.didiksetiawan.com/static/img/logo-high-resolution.png" property="og:image">
        
        
          
          <meta content="batch" property="article:section">
          
        
        
          
        
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@didik_swn">
        <meta name="twitter:creator" content="@didik_swn">
        
          <meta name="twitter:title" content="Setup Autoshutdown UPS on Windows">
        
        
          <meta name="twitter:url" content="https://www.didiksetiawan.com/blog/2015/03/18/setup-autoshutdown-ups-on-windows/">
        
        
          <meta name="twitter:description" content="Didik Setiawan's Blog">
        
        

      <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml">
      <script type="text/javascript">window.baseurl = 'https://www.didiksetiawan.com';</script>
      
        <!-- Custom Fonts -->
        <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css">

        <!-- FontAwesome icons -->
        <link rel="stylesheet" href="https://use.fontawesome.com/74dfc6cf47.css">

        <!-- Core BootStrap CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
        <!-- Material Design CSS -->
        <link rel="stylesheet" href="/static/css/bootstrap-material-design.min.css">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/static/css/syntax.css">

        <!-- Custom CSS -->        
        <link rel="stylesheet" href="/static/css/thickbox.css">
        <link rel="stylesheet" href="/static/css/main.css">
        <link rel="stylesheet" href="/static/css/projects.css">

        <script type="text/javascript">
          //loadingImage is relative to project dir
          var tb_pathToImage = "/static/img/loadingAnimation.gif";
        </script>

  </head>

  <body class="home overflow-hidden">
    <div class="header-panel shadow-z-2">
      <div class="container">
        <div class="row">
          <div class="col-md-3 col-sm-4 col-xs-12">
            <div class="row-picture">
              <img alt="dstw-avatar" id="about" class="logo-img" src="/static/img/avatar.png" height="75px" width="75px">
            </div>
            <div class="row-details">
              <h4 class="list-group-item-heading">Didik Setiawan</h4>
              <p class="list-group-item-text">cat ~/.life_history | grep fun</p>
              <div class="social-icons">
	
        <a class="icon" target="_blank" href="https://www.twitter.com/didik_swn"><i class="fa fa-twitter"></i></a>
    
        <a class="icon" target="_blank" href="https://www.github.com/dstw"><i class="fa fa-github"></i></a>
    
        <a class="icon" target="_blank" href="https://www.gitlab.com/dstw"><i class="fa fa-gitlab"></i></a>
    
        <a class="icon" target="_blank" href="https://stackoverflow.com/story/dstw"><i class="fa fa-stack-overflow"></i></a>
    
</div>

            </div>
            <div class="navbar-header pull-right">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <i class="fa fa-2x fa-bars"></i>
              </button>
            </div>
          </div>
          <div class="col-md-9 col-sm-8 col-xs-12">
          <div class="row">
            <h2 class="blog-title-pro col-md-6 col-sm-12 col-xs-12 ">Setup Autoshutdown UPS on Windows</h2>
            
            <div class="col-md-6 col-sm-12 col-xs-12 searchcontrol" id="js-search">
              <input class="form-control" type="text" id="js-search__input" placeholder="Search">
              <ul class="search__results" id="js-search__results"></ul>
            </div>
            
            </div>
            <p class="info">
              
                <span class="time">18 Mar 2015</span>
              
              
                <span class="categories">
                  &raquo; 
                  
                    <a href="/category/batch">batch</a>
                    , 
                  
                    <a href="/category/cmd">cmd</a>
                    , 
                  
                    <a href="/category/ups">ups</a>
                    , 
                  
                    <a href="/category/win_server_2008">win_server_2008</a>
                    , 
                  
                    <a href="/category/win_server_2008_r2">win_server_2008_r2</a>
                    
                  
                </span>
              
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="container main outer">
      <div class="row">
        <div class="col-md-3 col-xs-12">
              <nav class="menu">
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="list-separator nav navbar-nav well well-primary post">

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12 current-menu-item setup-autoshutdown-ups-on-windows"><a href="/" target="_self"><i class="fa fa-home"></i> Blog</a></li>

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  setup-autoshutdown-ups-on-windows"><a href="/about/" target="_self"><i class="fa fa-comments"></i> About</a></li>

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  setup-autoshutdown-ups-on-windows"><a href="mailto:ds@didiksetiawan.com" target="_self"><i class="fa fa-envelope"></i> Email</a></li>

</ul>

    </div>
    </nav>

        </div>
        <div class="col-md-9 col-xs-12 full">
          <div class="post-content well">
<article class="content">
    <div class="post"><p>Thus principally, to run computer autoshutdown using UPS software, is with link a batch script to perform shutdown. So, if there is a condition where the power is off, then that UPS software trigger the shutdown script to perform execution.
In this example, I will use two kinds of UPS that are Prolink PRO 1200 SFCU and Eaton AVR 625.</p>

<h3 id="prolink-pro-1200-sfcu">Prolink PRO 1200 SFCU</h3>

<p>In this example I use UPS on the computer with Windows Server 2008 R2 Operating System. The steps is explained below:
Login into computer with UPS installed
Install driver and UPS software. The insttaler can be download at:</p>

<p><a href="http://www.power-software-download.com/viewpower/installViewPower_Windows.zip">http://www.power-software-download.com/viewpower/installViewPower_Windows.zip</a></p>

<p>To install the software, we just click next as well as almost installation process on Windows. After installed successfully, there will appear UPS icon on Windows system tray and there is a notification message about this system is starting.
After installed, open control panel from that UPS software on browser with this address:</p>

<p><a href="http://127.0.0.1:15178/ViewPower/#">http://127.0.0.1:15178/ViewPower/#</a></p>

<p>Login as admin, the default password for Prolink PRO 1200 SFCU is “administrator”</p>

<p><img src="/static/img/ups1.png" alt="ups1" /></p>

<p><img src="/static/img/ups2.png" alt="ups2" /></p>

<p>Change this default password immediately on configuration menu ViewPower &gt; Change Password</p>

<p><img src="/static/img/ups3.png" alt="ups3" /></p>

<p>Check in to UPS Settings &gt; Local Shutdown</p>

<p><img src="/static/img/ups4.png" alt="ups4" /></p>

<p>Set the check box up on menu “When the UPS is running from the battery” and fill the section “Shut down the local system after” with value 6 (in minutes).<br />
In the section “Time to wait before shutting down the local system” fill with value 5 (in minutes).<br />
In the section “Maximum file execution time”, fill with value 1 (in minutes). <br />
In the section “File to execute when shutting down” fill with value of path to shutdown script. <br />
In the following example, I created script on C:\rshutdown.bat.</p>

<p><img src="/static/img/ups5.png" alt="ups5" /></p>

<p>Then make a new file with notepad, give it name rshutdown.bat, save on disk C. The contents:</p>

<figure class="highlight"><pre><code class="language-batch" data-lang="batch">C:\Windows\System32\shutdown.exe /s /t 20</code></pre></figure>

<p>That command is being used to shutdown the computer.</p>

<h3 id="eaton-avr-625">Eaton AVR 625</h3>

<p>Same as previous UPS configuration, the following setup I do with OS Windows Server 2008. The steps to setup are:
Install UPS Eaton AVR software that delivered with the CD. The installation process once again is almost same as the Windows application installation, we just click next and next.
After installation successful, set the UPS to run the shutdown process if a failure power source has occured.
Click icon on Windows system tray, check in to menu Settings.</p>

<p><img src="/static/img/ups6.png" alt="ups6" /></p>

<p>Fill with command line parameter where we save the batch file for shutdown. 
In the following example, I use file on “C:\User\edp11\Desktop\putty\shutdown.bat”</p>

<p><img src="/static/img/ups7.png" alt="ups7" /></p>

<p>The script contents is same as previous script we write:</p>

<figure class="highlight"><pre><code class="language-batch" data-lang="batch">C:\Windows\System32\shutdown.exe /s /t 20</code></pre></figure>

<p>Testing</p>

<p>This step is important. The purpose is to verify setup process we have done so far. The checking process can be done with, cut off the UPS power source so it can simulate a power shutdown condition.
After 5 minutes from the time the power source off, we can check if the autoshutdown process is success or not.
If the computer softly turned off (warm shutdown) the the UPS software setup is success.</p>

<p>Shutdown another Host on the Network</p>

<p>In the script above, the shutdown command is used to shutdown computer that connected directly to UPS via USB data cable.
In other way, for another computer with still on the same power source domain, the shutdown proccess can be applied via network with additional script and custom tools.
The detail is explained below.</p>

<p>Windows Host Shutdown</p>

<p>We will shutdown the computer with Windows OS use psshutdown tools. Download the tool on:</p>

<p><a href="https://download.sysinternals.com/files/PSTools.zip">https://download.sysinternals.com/files/PSTools.zip</a></p>

<p>Extract the psshutdown file, we only need this file to run the shutdown process.
Save following file in anywhere, in this example in C:\psshutdown.exe.
Then add the following file as file shutdown.bat:</p>

<figure class="highlight"><pre><code class="language-batch" data-lang="batch">C:\psshutdown.exe -u foo -p bar \172.16.10.245</code></pre></figure>

<p>In that example I use username foo and password bar and with IP 172.16.10.245. Set this with our need.
It is recommended to test the script with manually typing on the command prompt, to avoid notification from psshutdown application stop the shutdown process.
Because, on the first time, we will asked for confirmation about end user license agreement from this application.</p>

<p>Linux Host Shutdown</p>

<p>In order to shutdown Linux based host, we use another application from putty that is plink.exe. Download from:</p>

<p><a href="http://the.earth.li/~sgtatham/putty/latest/x86/putty.zip">http://the.earth.li/~sgtatham/putty/latest/x86/putty.zip</a></p>

<p>Confirm that we can automatic login to Linux. To do this, we need to generate public and private key for Windows host where the autoshutdown trigger is run.</p>

<p><img src="/static/img/ups8.png" alt="ups8" /></p>

<p>Click button Generate. While wait the key making process, we could moving the mouse in order to accelerate the process.</p>

<p><img src="/static/img/ups9.png" alt="ups9" /></p>

<p>After generating process, save the public and private key.
Save with easy name to find, for example for the public key we could named it key-server.pub and for the private key key-server.ppl.
If the following notification appear, then click Yes, just ignore it, because weneed automatic login without passpharase which same as password.</p>

<p><img src="/static/img/ups10.png" alt="ups10" /></p>

<p>For the next step, we need add public key that we have been created into host which want we access without password.
Login in to that host with putty and user root. Then type this commands.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">echo</span> <span class="s2">"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDOPrv4jtzSdRbaRY16miDNOnAYDnha0A+V92+ul88xCjLmLOYL78KyGKc1u47ZtCSpV590sLdSmXULvaSC6Fs8mVg+DdgumoBRZg1unwYGwUp9DKVjI+6DxAJIjwsarCS78TxtuGb+55ujnaJh4rSwLHnuqvDB3q6JtR/yET28Fq6RJ4Czjpv06X0EohfLVqwXdMKsZXbde/9vyFB9G1CrsnA6KXg1bsYDKW7xp4ayS4Q2yA1P7itX4zBNyRVQjdR5K/PTuNBzItbYiM7cyL6P6kfB3pnpZJQtK+IV0RhSPOQaaAJch+DwFcElamuENsDeE77PcYTLrqIxaIOYVPhh root@server"</span> <span class="o">&gt;&gt;</span> .ssh/authorized_keys</code></pre></figure>

<p>Change the parameter in the quotation mark (“ “) above using contents from key-server.pub public key file that exist.
Then add this script in to file shutdown.bat.</p>

<figure class="highlight"><pre><code class="language-batch" data-lang="batch">C:\plink.exe -i C:\key-server.ppk root@172.16.10.250 /sbin/poweroff</code></pre></figure>

<p>Extract plink.exe file from putty package we have been downloaded and save in C:, as well as the key-server.ppk private key.
Edit the IP Server above to your needs.</p>

<p>As well as the script to shutdown the Windows host, it is recommended to test the script with manually typing on the command prompt, to avoid notification from psshutdown application stop the shutdown process.</p>
</div>
    <hr />
    <div class="share-page">
    Share this on &rarr;
 <a href="https://twitter.com/share" class="twitter-share-button" data-via="didik_swn">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<!-- Google + -->
<div class="g-plus" data-action="share" data-annotation="bubble"></div>
<script src="https://apis.google.com/js/platform.js" async defer></script>

<!-- Facebook -->
<div class="fb-share-button" data-href="https://www.didiksetiawan.com/blog/2015/03/18/setup-autoshutdown-ups-on-windows/" data-layout="button_count" style="position: relative; top: -8px; left: 3px;"></div>
</div>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.6&appId=0";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
</article>
<hr />


    
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
    



<div class="PageNavigation">
  
    <a class="prev pull-left" href="https://www.didiksetiawan.com/blog/2015/02/26/linux-passwordless-login/">&laquo; Linux Passwordless Login</a>
  
  
    <a class="next pull-right" href="https://www.didiksetiawan.com/blog/2015/09/18/cacti-for-monitoring-windows-host/">Cacti for Monitoring Windows Host &raquo;</a>
  
</div>


<div class="disqus-comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* <![CDATA[ */

        var disqus_shortname = "didiksetiawan";
        var disqus_identifier = "https://www.didiksetiawan.com_Setup Autoshutdown UPS on Windows";
        var disqus_title = "Setup Autoshutdown UPS on Windows";

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    /* ]]> */
    </script>
</div>
</div>
          <div class="row">
            <div class="col-md-12 col-xs-12 footer">
              <footer>
	© 2009-2018 Didik Setiawan - Powered by Jekyll.
</footer>

            </div>
          </div>
        </div> <!-- end /.col-md-9 -->
      </div> <!-- end /.row -->
    </div>

    
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<script src="/static/js/super-search.js"></script>

<script src="/static/js/thickbox-compressed.js"></script>
<script src="/static/js/material.min.js"></script>
<script src="/static/js/main.js"></script>
<script src="/static/js/projects.js"></script>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-78151571-1', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
