<!DOCTYPE html>
<html>
  <head>
    
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="shortcut icon" href="/static/img/favicon.ico" />
        <title>Build Linux Kernel from Source - Didik Setiawan</title>
        <meta name="author" content="Didik Setiawan" />
        <meta name="description" content="Build Linux Kernel from Source" />
        <meta name="keywords" content="Build Linux Kernel from Source, Didik Setiawan, linux, kernel" />

        <meta content="0" property="fb:app_id">
        <meta content="Didik Setiawan" property="og:site_name">
        
          <meta content="Build Linux Kernel from Source" property="og:title">
        
        
          <meta content="article" property="og:type">
        
        
          <meta content="Didik Setiawan's Blog" property="og:description">
        
        
          <meta content="https://www.didiksetiawan.com/blog/2016/02/02/build-linux-kernel-from-source/" property="og:url">
        
        
          <meta content="2016-02-02T10:35:18+07:00" property="article:published_time">
          <meta content="https://www.didiksetiawan.com/about/" property="article:author">
        
        
          <meta content="https://www.didiksetiawan.com/static/img/logo-high-resolution.png" property="og:image">
        
        
          
          <meta content="linux" property="article:section">
          
        
        
          
        
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@didik_swn">
        <meta name="twitter:creator" content="@didik_swn">
        
          <meta name="twitter:title" content="Build Linux Kernel from Source">
        
        
          <meta name="twitter:url" content="https://www.didiksetiawan.com/blog/2016/02/02/build-linux-kernel-from-source/">
        
        
          <meta name="twitter:description" content="Didik Setiawan's Blog">
        
        

      <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml">
      <script type="text/javascript">window.baseurl = 'https://www.didiksetiawan.com';</script>
      
        <!-- Custom Fonts -->
        <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css">

        <!-- FontAwesome icons -->
        <link rel="stylesheet" href="https://use.fontawesome.com/74dfc6cf47.css">

        <!-- Core BootStrap CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
        <!-- Material Design CSS -->
        <link rel="stylesheet" href="/static/css/bootstrap-material-design.min.css">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/static/css/syntax.css">

        <!-- Custom CSS -->        
        <link rel="stylesheet" href="/static/css/thickbox.css">
        <link rel="stylesheet" href="/static/css/main.css">
        <link rel="stylesheet" href="/static/css/projects.css">

        <script type="text/javascript">
          //loadingImage is relative to project dir
          var tb_pathToImage = "/static/img/loadingAnimation.gif";
        </script>

  </head>

  <body class="home overflow-hidden">
    <div class="header-panel shadow-z-2">
      <div class="container">
        <div class="row">
          <div class="col-md-3 col-sm-4 col-xs-12">
            <div class="row-picture">
              <img alt="dstw-avatar" id="about" class="logo-img" src="/static/img/avatar.png" height="75px" width="75px">
            </div>
            <div class="row-details">
              <h4 class="list-group-item-heading">Didik Setiawan</h4>
              <p class="list-group-item-text">Let the bits speak</p>
              <div class="social-icons">
	
        <a class="icon" target="_blank" href="https://www.twitter.com/didik_swn"><i class="fa fa-twitter"></i></a>
    
        <a class="icon" target="_blank" href="https://www.github.com/dstw"><i class="fa fa-github"></i></a>
    
        <a class="icon" target="_blank" href="https://www.gitlab.com/dstw"><i class="fa fa-gitlab"></i></a>
    
        <a class="icon" target="_blank" href="https://www.linkedin.com/in/didiksetiawan"><i class="fa fa-linkedin"></i></a>
    
        <a class="icon" target="_blank" href="mailto:ds@didiksetiawan.com"><i class="fa fa-envelope"></i></a>
    
</div>

            </div>
            <div class="navbar-header pull-right">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <i class="fa fa-2x fa-bars"></i>
              </button>
            </div>
          </div>
          <div class="col-md-9 col-sm-8 col-xs-12">
          <div class="row">
            <h2 class="blog-title-pro col-md-6 col-sm-12 col-xs-12 ">Build Linux Kernel from Source</h2>
            
            <div class="col-md-6 col-sm-12 col-xs-12 searchcontrol" id="js-search">
              <input class="form-control" type="text" id="js-search__input" placeholder="Search">
              <ul class="search__results" id="js-search__results"></ul>
            </div>
            
            </div>
            <p class="info">
              
                <span class="time">02 Feb 2016</span>
              
              
                <span class="categories">
                  &raquo; 
                  
                    <a href="/category/linux">linux</a>
                    , 
                  
                    <a href="/category/kernel">kernel</a>
                    
                  
                </span>
              
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="container main outer">
      <div class="row">
        <div class="col-md-3 col-xs-12">
              <nav class="menu">
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="list-separator nav navbar-nav well well-primary post">

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12 current-menu-item build-linux-kernel-from-source"><a href="/" target="_self"><i class="fa fa-home"></i> Blog</a></li>

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  build-linux-kernel-from-source"><a href="/about/" target="_self"><i class="fa fa-comments"></i> About</a></li>

</ul>

    </div>
    </nav>

        </div>
        <div class="col-md-9 col-xs-12 full">
          <div class="post-content well">
<article class="content">
    <div class="post"><p>In order to doing some research in operating system, I need to build Linux
kernel from source. Although my GNU/Linux distro provide Linux kernel package
which ready to use, I can not use it for Linux Kernel development. It is
recommended to be able build my own Linux kernel in order to customize my build.</p>

<h2 id="build--install">Build &amp; Install</h2>

<p>To build the Linux kernel from source, I need several tools: <code class="highlighter-rouge">make</code>, <code class="highlighter-rouge">gcc</code>,
<code class="highlighter-rouge">libssl-dev</code>, <code class="highlighter-rouge">git</code> and (optionally) <code class="highlighter-rouge">ctags</code>, <code class="highlighter-rouge">cscope</code>, and/or <code class="highlighter-rouge">ncurses-dev</code>.
<code class="highlighter-rouge">make</code> &amp; <code class="highlighter-rouge">gcc</code> is essential tools to build binaries from source. <code class="highlighter-rouge">libssl-dev</code> is
for cryptography purpose. <code class="highlighter-rouge">git</code> is used for control the revision of the source
code, it is recommended if I want to submit patch regarding Linux Kernel. The
<code class="highlighter-rouge">ncurses-dev</code> tools are used if I <code class="highlighter-rouge">make menuconfig</code> or <code class="highlighter-rouge">make nconfig</code>. The tool
packages may be called something else in some Linux distribution, so I may need
to determine the package first.</p>

<p>I use Ubuntu, so I can get these tools by running:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">sudo </span>apt <span class="nb">install </span>make gcc libssl-dev bc git exuberant-ctags libncurses5-dev</code></pre></figure>

<p>If you using different Linux distro, on Red Hat based systems like Fedora,
CentOS you can run:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">sudo </span>yum <span class="nb">install </span>gcc make git ctags ncurses-devel openssl-devel</code></pre></figure>

<p>And on SUSE based systems (like SLES, Leap or Tumbleweed), you can run:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">sudo </span>zypper <span class="k">in </span>git gcc ncurses-devel libopenssl-devel ctags cscope</code></pre></figure>

<p>If you develop using git, there are different development tree of Linux Kernel
available. Different tree serve different purpose. Some of them I often use:</p>

<ul>
  <li>rc: The latest version out from Linus Torvald tree. It serves main purpose to
include some new feature or fix which ready for testing. Not recommended for
production use.</li>
  <li>stable: Kernel marked stable are come from the stable maintainer which
currently done by Greg-Kroah Hartman. This version good for production use.</li>
  <li>staging: The staging tree is collection of new driver which not yet ready to
be included in Linus rc tree. This one highly recommended for new and aspiring
Linux Kernel developer who want to contribute.</li>
</ul>

<p>I need to change configuration parameters to determine which settings and
modules which need to build. Several options available:</p>

<h4 id="1-use-default-kernel-configuration">1. Use default kernel configuration.</h4>
<p>This settings comes from the kernel maintainer. Remember, a default config may
not have the options you are currently using.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>make defconfig</code></pre></figure>

<h4 id="2-use-existing-configuration">2. Use existing configuration.</h4>
<p>Just press “Enter” when asked for configuration options.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>make localmodconfig</code></pre></figure>

<h4 id="3-manual-selection-with-graphical-menu">3. Manual selection with graphical menu.</h4>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>make menuconfig</code></pre></figure>

<p>Compiling a kernel from scratch from a distribution configuration can take
“forever” because the distros turn on every hardware configuration possible. For
people wanting to do kernel development fast, you want to make a minimal
configuration. Steve Rostedt uses ktest.pl make_min_config to get a truely
minimum config, but it will take a day or two to build. Warning: make sure you
have all your USB devices plugged into the system, or you won’t get the drivers
for them!</p>

<h4 id="4--duplicate-current-config">4.  Duplicate current config.</h4>

<p>When I want to see if a bug is fixed, I can duplicate the configuration on my
running kernel. That config file is stored somewhere in /boot/. There might be
several files that start with config, so I can use the one associated with your
running kernel. I can find it by running <code class="highlighter-rouge">uname -a</code> and finding the config file
that ends with my kernel version number. I copy that file into the source
directory as .config. Or just run this command:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">sudo cp</span> /boot/config-<span class="sb">`</span><span class="nb">uname</span> <span class="nt">-r</span><span class="sb">`</span><span class="k">*</span> .config</code></pre></figure>

<p>Among these options, I tend to use latest option because it use config from
distro developer and cause it recognizes most of my hardware.</p>

<p>Then, compile source, this process can take a while.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>make <span class="nt">-jX</span></code></pre></figure>

<p>Where X is a number like 2 or 4. If you have a dual core, 2 or 3 might be good.
Quad core, 4 or 6. Do not run with really big numbers unless you want your
machine to be slow. You can check the number with:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cat</span> /proc/cpuinfo</code></pre></figure>

<p>On my machine, there are 0-3 processor available. I want to use all of these
resources to perform the compiling process. So I can use <code class="highlighter-rouge">make -j4</code>.<br />
This compiling process can take a lot of time. So you can make the time to do
some other interesting tasks such as read books of Linux Kernel development,
read LWN, lurking on LKML, etc.</p>

<p>Install modules.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">sudo </span>make modules_install</code></pre></figure>

<p>Bootloader setup.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">sudo </span>make <span class="nb">install</span></code></pre></figure>

<p>Double check bootloader setup.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">sudo </span>update-grub2</code></pre></figure>

<p>Reboot the system.
I can check my new installed kernel with this command.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">uname</span> <span class="nt">-a</span></code></pre></figure>

<p>Enjoy the new kernel.</p>

<h2 id="remove">Remove</h2>

<p>When there is such as installation process, then there should be the
unintallation process too.<br />
Fist I need to find out the version of custom kernel. I can look at <code class="highlighter-rouge">/boot</code>
directory.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">ls</span> /boot/</code></pre></figure>

<p>There are several files. I can refer to the vmlinuz files to determine which
version I need to process.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">/boot/vmlinuz-4.15.0-23-generic
/boot/vmlinuz-4.15.0-29-generic
/boot/vmlinuz-4.18.0-rc5
/boot/vmlinuz-4.18.0-rc6</code></pre></figure>

<p>In this example, I want to remove kernel version 4.18.0-rc5.<br />
But, before doing this, I must ensure that my system has other kernel installed
beside $CUSTOM_KERNEL_VERSION. Also I must ensure that I not removing kernel
which I currently running on, because it can lead to unexpected behaviour of my
system. When everything is okay, I can delete all files and folders which
contain $CUSTOM_KERNEL_VERSION name.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ CUSTOM_KERNEL_VERSION</span><span class="o">=</span><span class="s2">"4.18.0-rc5"</span>
<span class="nv">$ </span><span class="nb">sudo rm</span> /boot/vmlinuz-<span class="nv">$CUSTOM_KERNEL_VERSION</span>
<span class="nv">$ </span><span class="nb">sudo rm</span> /boot/initrd.img-<span class="nv">$CUSTOM_KERNEL_VERSION</span>
<span class="nv">$ </span><span class="nb">sudo rm</span> /boot/System.map-<span class="nv">$CUSTOM_KERNEL_VERSION</span>
<span class="nv">$ </span><span class="nb">sudo rm</span> /boot/config-<span class="nv">$CUSTOM_KERNEL_VERSION</span>
<span class="nv">$ </span><span class="nb">sudo rm</span> <span class="nt">-rf</span> /lib/modules/<span class="nv">$CUSTOM_KERNEL_VERSION</span>/
<span class="nv">$ </span><span class="nb">sudo rm</span> /var/lib/initramfs-tools/<span class="nv">$CUSTOM_KERNEL_VERSION</span></code></pre></figure>

<p>Lastly, I do some cleaning.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">sudo </span>update-initramfs <span class="nt">-k</span> all <span class="nt">-u</span>
<span class="nv">$ </span><span class="nb">sudo </span>update-grub2</code></pre></figure>

<p>Finish. My kernel has been successfully uninstalled.</p>
</div>
    <hr />
    <div class="share-page">
    Share this on &rarr;
 <a href="https://twitter.com/share" class="twitter-share-button" data-via="didik_swn">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<!-- Google + -->
<div class="g-plus" data-action="share" data-annotation="bubble"></div>
<script src="https://apis.google.com/js/platform.js" async defer></script>

<!-- Facebook -->
<div class="fb-share-button" data-href="https://www.didiksetiawan.com/blog/2016/02/02/build-linux-kernel-from-source/" data-layout="button_count" style="position: relative; top: -8px; left: 3px;"></div>
</div>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.6&appId=0";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
</article>
<hr />


    
    
        
            
        
            
        
    
        
            
        
            
        
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
                
                <div class="panel-body">
                <h4>Related Posts</h4>
                <ul>
                
                <li class="relatedPost">
                    <a href="https://www.didiksetiawan.com/blog/2016/09/02/convert-text-to-pdf-on-linux/">Convert Text to Pdf on Linux</a>
                    
                        <small>(Categories: <a href="/category/linux">linux</a>, <a href="/category/documentation">documentation</a>, <a href="/category/text">text</a>)</small>
                    
                </li>
                
                
            
        
            
        
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
                
                <li class="relatedPost">
                    <a href="https://www.didiksetiawan.com/blog/2016/05/03/insert-usb-module-linux-kernel/">Insert USB Module in Linux Kernel</a>
                    
                        <small>(Categories: <a href="/category/linux">linux</a>, <a href="/category/kernel">kernel</a>)</small>
                    
                </li>
                
                
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    


    </ul>
    </div>


<div class="PageNavigation">
  
  
    <a class="next pull-right" href="https://www.didiksetiawan.com/blog/2016/05/03/insert-usb-module-linux-kernel/">Insert USB Module in Linux Kernel &raquo;</a>
  
</div>


<div class="disqus-comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* <![CDATA[ */

        var disqus_shortname = "didiksetiawan";
        var disqus_identifier = "https://www.didiksetiawan.com_Build Linux Kernel from Source";
        var disqus_title = "Build Linux Kernel from Source";

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    /* ]]> */
    </script>
</div>
</div>
          <div class="row">
            <div class="col-md-12 col-xs-12 footer">
              <footer>
	© 2009-2018 Didik Setiawan - Powered by Jekyll.
</footer>

            </div>
          </div>
        </div> <!-- end /.col-md-9 -->
      </div> <!-- end /.row -->
    </div>

    
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<script src="/static/js/super-search.js"></script>

<script src="/static/js/thickbox-compressed.js"></script>
<script src="/static/js/material.min.js"></script>
<script src="/static/js/main.js"></script>
<script src="/static/js/projects.js"></script>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-78151571-1', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
